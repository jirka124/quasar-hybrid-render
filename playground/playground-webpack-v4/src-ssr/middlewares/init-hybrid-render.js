/*
  THIS FILE IS AUTO-GENERATED by hybrid-render extension of Quasar.
  You should not temper with this file, unless really needed.
*/

import { ssrMiddleware } from 'quasar/wrappers'
import { init } from '../../src-hr/config.js'
import { handleError } from '../../src-hr/utils.js'
import { extendConfig } from '../../src-hr/utils.js'

export default ssrMiddleware(({ app, resolve, render, serve }) => {
  app.get(resolve.urlPath('*'), async (req, res, next) => {
    try {
      // initiate hybridRender with defaults
      req.hybridRender = init()

      // bind hybridRender's extendConfig with itself
      req.hybridRender.extendConfig = extendConfig.bind(null, req.hybridRender)

      next()
    } catch (err) {
      // if is dev, serve an quasar error
      if (process.env.DEV && !res.headersSent) {
        serve.error({
          err,
          req,
          res,
        })
      }

      // propagate error to error handler
      next(handleError(err))
    }
  })
})
