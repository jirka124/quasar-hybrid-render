/*
  THIS FILE IS AUTO-GENERATED by hybrid-render extension of Quasar.
  You should not temper with this file, unless really needed.
*/

const isNotNullObject = (obj) => {
  return typeof obj === "object" && !Array.isArray(obj) && obj !== null;
};

// merges any number of objects into one, last one has precedence and first is used as target
const deepMerge = (...objectArr) => {
  const target = objectArr.length > 0 ? objectArr[0] : {};

  for (let i = 1, obj = null; i < objectArr.length; i++) {
    obj = objectArr[i];

    for (const key in obj) {
      if (isNotNullObject(obj[key])) {
        if (isNotNullObject(target[key]))
          target[key] = deepMerge(target[key], obj[key]);
        else target[key] = obj[key];
      } else target[key] = obj[key];
    }
  }

  return target;
};

// joins current config with new config
const extendConfig = (configObj, extendBy) => {
  deepMerge(configObj, extendBy);
};

// get pathname of provided url with stripped trailing slash
const getNormPathname = (fromUrl) => {
  let url = new URL("http://none" + fromUrl);
  return url.pathname.endsWith("/") && url.pathname !== "/"
    ? url.pathname.slice(0, -1)
    : url.pathname;
};

// get default filename based on config
const getDefaultFilename = ({ filename = "index", extension = ".html" }) => {
  return `${filename}${extension}`;
};

// add extension to filename if not there already
const addExtension = ({
  filename = "index",
  config = { autoAddExt: true, extension: ".html" },
}) => {
  if (config.autoAddExt && !filename.endsWith(config.extension))
    return `${filename}${config.extension}`;
  return filename;
};

class ExpressError extends Error {
  constructor(message = `HYBRID_EXT_UNKNOWN`, status = 500, options) {
    super(message, options);
    this.status = status;
  }
}

const handleError = (err) => {
  if (
    !Object.hasOwn(err, "message") ||
    !err.message.startsWith("HYBRID_EXT_")
  ) {
    // is not recognised as internal known error, mark as unknown
    err.message = `HYBRID_EXT_UNKNOWN: ${err.message || ""}`;
  }

  return err;
};

module.exports = {
  isNotNullObject,
  deepMerge,
  extendConfig,
  getNormPathname,
  getDefaultFilename,
  addExtension,
  ExpressError,
  handleError,
};
